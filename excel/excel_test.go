package excel

import (
	"crypto/md5"
	"encoding/hex"
	"fmt"
	"github.com/astaxie/beego/httplib"
	"io/ioutil"
	"net/http"
	"strings"
	"testing"
	"time"
)

func TestExcel(t *testing.T) {
	bytes, _ := ioutil.ReadFile("/Users/admin/Downloads/query_result_2021-04-23T13_39_19.402Z.csv")
	str := string(bytes)

	games := strings.Split(str, ",")

	for i := range games {
		if i == 0 {
			continue
		}
		fileds := strings.Split(games[i], ",")

		header, err := http.Head(fileds[2])
		if err != nil {
			fmt.Println(err)
		}

		bytes, err := httplib.Get(fileds[2]).Bytes()
		if err != nil {
			fmt.Println(err)
		}
		h := md5.New()
		h.Write(bytes)
		md5 := hex.EncodeToString(h.Sum(nil))
		fmt.Printf(`update game_list set rom_size = %d,rom_md5 = "%s" where id = %s;`, header.ContentLength, md5, fileds[0])
		fmt.Println()
	}
}

var str = "(13838552,8122584,4178837,1191715,3637514,5659276,9658286,10461746,13631628,2626785,3841776,14976678,1026894,13271697,2203273,14831251,15497696,6289593,1489838,145747272,14268245,2405738,5182924,11514533,14534099,1945778,1007590,1366811,14402955,1435482,4935862,1829604,8178937,12766558,13309737,9739640,8953533,4109161,14473286,2338970,9493861,2959684,5652057,14574715,3142458,15761113,12880772,12709784,9754545,5107957,2917984,6134783,1100945,13441508,1335347,13679115,14665467,3241241,4954141,1291132,3826141,2544296,14756204,4376122,6527219,10769980,10976212,14615336,6503905,1840368,2524726,1720317,3944680,10098828,1399572,14156675,2735332,7786910,9093630)"

var str2 = "[{\"Id\":350951},{\"Id\":129459},{\"Id\":291863},{\"Id\":154329},{\"Id\":152537},{\"Id\":629430},{\"Id\":657436},{\"Id\":687318},{\"Id\":720537},{\"Id\":770711},{\"Id\":987997},{\"Id\":1092698},{\"Id\":1103078},{\"Id\":28280},{\"Id\":1455115},{\"Id\":1586270},{\"Id\":1651786},{\"Id\":1768349},{\"Id\":1787532},{\"Id\":1868575},{\"Id\":1975344},{\"Id\":2155706},{\"Id\":2196847},{\"Id\":2377163},{\"Id\":313091},{\"Id\":2870107},{\"Id\":3075332},{\"Id\":3090837},{\"Id\":3193855},{\"Id\":3360318},{\"Id\":3430628},{\"Id\":3633497},{\"Id\":4217891},{\"Id\":4236437},{\"Id\":4392940},{\"Id\":4468423},{\"Id\":93029},{\"Id\":4947592},{\"Id\":5423196},{\"Id\":5577868},{\"Id\":5792502},{\"Id\":5815895},{\"Id\":7077833},{\"Id\":7413982},{\"Id\":7470531},{\"Id\":8246297},{\"Id\":8386936},{\"Id\":8787960},{\"Id\":8952541},{\"Id\":9034027},{\"Id\":9048941},{\"Id\":9390474},{\"Id\":9740601},{\"Id\":10033372},{\"Id\":10230777},{\"Id\":10734774},{\"Id\":11925960},{\"Id\":11982468},{\"Id\":12095871},{\"Id\":12484613},{\"Id\":12522343},{\"Id\":12648608},{\"Id\":12838094},{\"Id\":12885469},{\"Id\":13044299},{\"Id\":13360955},{\"Id\":13472103},{\"Id\":13606299},{\"Id\":13676303},{\"Id\":13736863},{\"Id\":13777389},{\"Id\":13817786},{\"Id\":13867784},{\"Id\":13958124},{\"Id\":14032802},{\"Id\":14177668},{\"Id\":14696700},{\"Id\":14959061}]"

func TestStr(t *testing.T) {
	fmt.Println(time.Now().UnixNano() / 1000000)
	fmt.Println(time.Now().Unix())
	fmt.Println((time.Now().UnixNano() / 1000000) & 0x7fffffff)
}
